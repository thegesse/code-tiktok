<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Codetok - Play</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">

    <style>
        .CodeMirror { height: 350px; border-radius: 8px; font-family: 'Courier New', monospace; }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; }
        .alert-success { background: #d4edda; color: #155724; }
        .alert-danger { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body class="play-page">

<div th:replace="~{fragments/nav :: navbar}"></div>

<div class="feed-container">
    <div th:if="${message == 'PASS'}" class="alert alert-success">Correct! The AI verified your fix.</div>
    <div th:if="${message == 'FAIL'}" class="alert alert-danger">Not quite. Check your logic and try again!</div>

    <div class="code-card">
        <h3>Buggy Code:</h3>
        <pre th:text="${problem.code}" style="background: #1e2127; color: #7f848e; padding: 15px; border-radius: 8px; overflow-x: auto;"></pre>

        <form th:action="@{/check-answer}" method="post" id="codeForm">
            <input type="hidden" name="problemId" th:value="${problem.id}">

            <label>Your Corrected Code:</label>
            <div id="editor-container"></div>

            <input type="hidden" name="userAnswer" id="userAnswer">

            <div class="button-group">
                <button type="submit">Submit Solution</button>
                <a th:href="@{/play}">Next Problem</a>
            </div>
        </form>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/clike/clike.min.js"></script>

<script>
    const editor = CodeMirror(document.getElementById("editor-container"), {
        lineNumbers: true,
        theme: "dracula",
        mode: "text/x-java",
        value: `[[${problem.code}]]`
    });

    document.getElementById("codeForm").addEventListener("submit", function() {
        document.getElementById("userAnswer").value = editor.getValue();
    });
</script>
</body>
</html>